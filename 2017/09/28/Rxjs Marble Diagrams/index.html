<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="blog"><meta name="keywords" content="front-end, js, node, react, redux, rxjs"><title>Rxjs Marble Diagrams | Hello world</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/blog/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/blog/favicon.ico"><link rel="bookmark" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/blog/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Rxjs Marble Diagrams</h1><a id="logo" href="/blog/.">Hello world</a><p class="description">2017</p></div><div id="nav-menu"><a href="/blog/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/blog/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/blog/about/"><i class="fa fa-user"> 关于</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Rxjs Marble Diagrams</h1><div class="post-meta"><a href="/blog/2017/09/28/Rxjs Marble Diagrams/#comments" class="comment-count"></a><p><span class="date">Sep 28, 2017</span><span><a href="/blog/categories/rxjs/" class="category">rxjs</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>我們用 - 來表達一小段時間，這些 - 串起就代表一個 observable。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">----------------</div></pre></td></tr></table></figure></p>
<p><code>X</code> (大寫 X)則代表有錯誤發生<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">---------------X</div></pre></td></tr></table></figure></p>
<p><code>|</code> 則代表 observable 結束<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">----------------|</div></pre></td></tr></table></figure></p>
<h4 id="1-of"><a href="#1-of" class="headerlink" title="1. of"></a>1. of</h4><p>observable 是同步送值的時候, 小括號代表著同步發生。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(1234)|</div></pre></td></tr></table></figure>
<h4 id="2-interval"><a href="#2-interval" class="headerlink" title="2. interval"></a>2. interval</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-----0-----1-----2-----3--...</div></pre></td></tr></table></figure>
<h4 id="3-map"><a href="#3-map" class="headerlink" title="3. map"></a>3. map</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> newest = source.map(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">2</span>); </div><div class="line">newest.subscribe(<span class="built_in">console</span>.log);</div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5..</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source: -----0-----1-----2-----3--...</div><div class="line">            map(x =&gt; x + 1)</div><div class="line">newest: -----1-----2-----3-----4--...</div></pre></td></tr></table></figure>
<h4 id="4-mapTo"><a href="#4-mapTo" class="headerlink" title="4. mapTo"></a>4. mapTo</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> newest = source.mapTo(<span class="number">2</span>); </div><div class="line">newest.subscribe(<span class="built_in">console</span>.log);</div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 2..</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source: -----0-----1-----2-----3--...</div><div class="line">                mapTo(2)</div><div class="line">newest: -----2-----2-----2-----2--...</div></pre></td></tr></table></figure>
<h4 id="5-filter"><a href="#5-filter" class="headerlink" title="5. filter"></a>5. filter</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> newest = source.filter(<span class="function"><span class="params">x</span> =&gt;</span> x % <span class="number">2</span> === <span class="number">0</span>); </div><div class="line"></div><div class="line">newest.subscribe(<span class="built_in">console</span>.log);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 6..</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source: -----0-----1-----2-----3-----4-...</div><div class="line">            filter(x =&gt; x % 2 === 0)</div><div class="line">newest: -----0-----------2-----------4-...</div></pre></td></tr></table></figure>
<h4 id="6-take"><a href="#6-take" class="headerlink" title="6. take"></a>6. take</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> example = source.take(<span class="number">3</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : -----0-----1-----2-----3--..</div><div class="line">                take(3)</div><div class="line">example: -----0-----1-----2|</div></pre></td></tr></table></figure>
<h4 id="7-first"><a href="#7-first" class="headerlink" title="7. first"></a>7. first</h4><p>和 take(1)一致<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> example = source.first();</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : -----0-----1-----2-----3--..</div><div class="line">                first()</div><div class="line">example: -----0|</div></pre></td></tr></table></figure>
<h4 id="8-takeLast"><a href="#8-takeLast" class="headerlink" title="8. takeLast"></a>8. takeLast</h4><p>takeLast 必須等到整個 observable 完成(complete)，才能知道最後的元素有哪些，並且同步送出<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>);</div><div class="line"><span class="keyword">var</span> example = source.takeLast(<span class="number">2</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2----3----4----5|</div><div class="line">                takeLast(2)</div><div class="line">example: ------------------------------(45)|</div></pre></td></tr></table></figure>
<h4 id="9-last"><a href="#9-last" class="headerlink" title="9. last"></a>9. last</h4><p>相当于 takeLast(1)，用來取得最後一個元素。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">6</span>);</div><div class="line"><span class="keyword">var</span> example = source.last();</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 5</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2----3----4----5|</div><div class="line">                    last()</div><div class="line">example: ------------------------------(5)|</div></pre></td></tr></table></figure>
<h4 id="10-takeUntil"><a href="#10-takeUntil" class="headerlink" title="10. takeUntil"></a>10. takeUntil</h4><p>當 takeUntil 傳入的 observable 發送值時，原本的 observable 就會直接進入完成(complete)的狀態，並且發送完成訊息。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> example = source.takeUntil(click);     </div><div class="line">   </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// complete (點擊body了)</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source : -----0-----1-----2------3--</div><div class="line">click  : ----------------------c----</div><div class="line">                takeUntil(click)</div><div class="line">example: -----0-----1-----2----|</div></pre></td></tr></table></figure>
<h4 id="11-concat"><a href="#11-concat" class="headerlink" title="11. concat"></a>11. concat</h4><p><code>concat</code> 可以把多個 observable 實例合併成一個<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> source2 = Rx.Observable.of(<span class="number">3</span>)</div><div class="line"><span class="keyword">var</span> source3 = Rx.Observable.of(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</div><div class="line"><span class="keyword">var</span> example = source.concat(source2, source3);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5</span></div><div class="line"><span class="comment">// 6</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2|</div><div class="line">source2: (3)|</div><div class="line">source3: (456)|</div><div class="line">            concat()</div><div class="line">example: ----0----1----2(3456)|</div></pre></td></tr></table></figure>
<p>另外 concat 還可以當作靜態方法使用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> source2 = Rx.Observable.of(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> source3 = Rx.Observable.of(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>);</div><div class="line"><span class="keyword">var</span> example = Rx.Observable.concat(source, source2, source3);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="12-concatAll"><a href="#12-concatAll" class="headerlink" title="12. concatAll"></a>12. concatAll</h4><p>Observable 送出的元素又是一個 observable，就像是二維陣列，陣列裡面的元素是陣列，可以用 <code>concatAll</code> 把它攤平成一維陣列. 把二维阵列变成维.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> source = click.map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.concatAll();</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">click  : ------c------------c--------</div><div class="line"></div><div class="line">        map(e =&gt; Rx.Observable.of(1,2,3))</div><div class="line"></div><div class="line">source : ------o------------o--------</div><div class="line">                \            \</div><div class="line">                 (123)|       (123)|</div><div class="line"></div><div class="line">                   concatAll()</div><div class="line"></div><div class="line">example: ------(123)--------(123)------------</div></pre></td></tr></table></figure>
<p>這裡需要注意的是 <code>concatAll</code> 會處理 source 先發出來的 observable，必須等到這個 observable 結束，才會再處理下一個 source 發出來的 observable。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obs1 = Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">5</span>);</div><div class="line"><span class="keyword">var</span> obs2 = Rx.Observable.interval(<span class="number">500</span>).take(<span class="number">2</span>);</div><div class="line"><span class="keyword">var</span> obs3 = Rx.Observable.interval(<span class="number">2000</span>).take(<span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> source = Rx.Observable.of(obs1, obs2, obs3);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.concatAll();</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">source : (o1                 o2      o3)|</div><div class="line">           \                  \       \</div><div class="line">            --0--1--2--3--4|   -0-1|   ----0|</div><div class="line">                </div><div class="line">                concatAll()        </div><div class="line"></div><div class="line">example: --0--1--2--3--4-0-1----0|</div></pre></td></tr></table></figure>
<h4 id="13-skip"><a href="#13-skip" class="headerlink" title="13. skip"></a>13. skip</h4><p>原本從 0 開始的就會變成從 3 開始，<b>但是記得原本元素的等待時間仍然存在</b>，也就是說此範例第一個取得的元素需要等 4 秒，用 Marble Diagram 表示如下。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> example = source.skip(<span class="number">3</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5...</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2----3----4----5--....</div><div class="line">                    skip(3)</div><div class="line">example: -------------------3----4----5--...</div></pre></td></tr></table></figure>
<h4 id="14-startWith"><a href="#14-startWith" class="headerlink" title="14. startWith"></a>14. startWith</h4><p><code>startWith</code> 的值是一開始就同步發出的，這個 operator 很常被用來保存程式的起始狀態！<br>下面的例子，不会过1秒才出现<code>0</code>，而是马上出现<code>0</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> example = source.startWith(<span class="number">0</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0 马上发出</span></div><div class="line"><span class="comment">// 0 过1秒</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3...</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2----3--...</div><div class="line">                startWith(0)</div><div class="line">example: (0)----0----1----2----3--...</div></pre></td></tr></table></figure>
<h4 id="15-merge"><a href="#15-merge" class="headerlink" title="15. merge"></a>15. merge</h4><p><code>merge</code> 把多個 observable 同時處理，這跟 <code>concat</code> 一次處理一個 observable 是完全不一樣的.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>).take(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> source2 = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">6</span>);</div><div class="line"><span class="keyword">var</span> example = source.merge(source2);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2|</div><div class="line">source2: --0--1--2--3--4--5|</div><div class="line">            merge()</div><div class="line">example: --0-01--21-3--(24)--5|</div></pre></td></tr></table></figure>
<p><b style="color: red">這很常用在一個以上的按鈕具有部分相同的行為。</b><br>例如一個影片播放器有兩個按鈕，一個是暫停(II)，另一個是結束播放(口)。這兩個按鈕都具有相同的行為就是影片會被停止，只是結束播放會讓影片回到 00 秒，這時我們就可以把這兩個按鈕的事件 merge 起來處理影片暫停這件事。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> stopVideo = Rx.Observable.merge(stopButton, endButton);</div><div class="line"></div><div class="line">stopVideo.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// 暫停播放影片</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>非同步最難的地方在於，當有多個非同步行為同時觸發且相互依賴，這時候我們要處理的邏輯跟狀態就會變得極其複雜.<br><b>它們都是在多個元素送進來時，只輸出一個新元素.</b></p>
<h4 id="16-combineLatest"><a href="#16-combineLatest" class="headerlink" title="16. combineLatest"></a>16. combineLatest</h4><p>它會取得各個 observable 最後送出的值，再輸出成一個值.<br><b style="color:red">描述:</b></p>
<pre><code>1. newest 和 source 其中一个送出值的时候
2. 和另外一个最新送出的值
3. 传入callback
4. 当newest 和 source 都结束了, 才会complete
</code></pre><p><b style="color:red">例子流程:</b></p>
<pre><code>*   newest 送出了 `0`，source 没有送出，不會執行 callback
*   source 送出了 `0`，newest 送出`0`，callback 等于 `0`
*   newest 送出了 `1`，source 送出 `0`，callback 等于 `1`
........................
*   newest 和 source 都結束了，complete
</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>).take(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> newest = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">6</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.combineLatest(newest, (x, y) =&gt; x + y);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// 5</span></div><div class="line"><span class="comment">// 6</span></div><div class="line"><span class="comment">// 7</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2|</div><div class="line">newest : --0--1--2--3--4--5|</div><div class="line"></div><div class="line">    combineLatest(newest, (x, y) =&gt; x + y);</div><div class="line"></div><div class="line">example: ----01--23-4--(56)--7|</div></pre></td></tr></table></figure>
<p><b style="color:red">应用:</b><br>combineLatest 很常用在運算多個因子的結果;<br>A 和 B的值求出C, A 变化, 则C变化; B变化, 则C也变化</p>
<h4 id="17-zip"><a href="#17-zip" class="headerlink" title="17. zip"></a>17. zip</h4><p><b style="color:red">描述:</b></p>
<pre><code>1. newest 和 source 其中一个送出值的时候
2. 若当前另1个同位置有值
3. 传入callback
4. 任意1个结束, 就会complete
</code></pre><p><b>例子流程:</b></p>
<ul>
<li>newest 送出了 <code>0</code>，source没有送出，不會執行 callback</li>
<li>source 送出了 <code>0</code>，newest送出<code>0</code>，callback 等于 <code>0</code><br>….. 一直不执行callback</li>
<li>source 送出了 <code>1</code>，newest虽然现在最新的是<code>2</code>，但是之前送出的是 <code>1</code>，callback等于<code>2(1+1)</code><br>….. 一直不执行callback</li>
<li>source 送出了 <code>2</code>，newest之前送出的是 <code>2</code>， callback 等于 <code>4</code></li>
<li>source 結束 example 就結束，因為 source 跟 newest 不會再有對應位置的值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">500</span>).take(<span class="number">3</span>);</div><div class="line"><span class="keyword">var</span> newest = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">6</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.zip(newest, (x, y) =&gt; x + y);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source : ----0----1----2|</div><div class="line">newest : --0--1--2--3--4--5|</div><div class="line">    zip(newest, (x, y) =&gt; x + y)</div><div class="line">example: ----0----2----4|</div></pre></td></tr></table></figure>
<p><b style="color:red">应用:</b></p>
<p>zip 适用原本只能同步送出的資料變成了非同步的, 常拿來做 demo 使用，比如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.from(<span class="string">'hello'</span>);</div><div class="line"><span class="keyword">var</span> source2 = Rx.Observable.interval(<span class="number">100</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.zip(source2, (x, y) =&gt; x);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source : (hello)|</div><div class="line">source2: -0-1-2-3-4-...</div><div class="line">        zip(source2, (x, y) =&gt; x)</div><div class="line">example: -h-e-l-l-o|</div></pre></td></tr></table></figure>
<h4 id="18-withLatestFrom"><a href="#18-withLatestFrom" class="headerlink" title="18. withLatestFrom"></a>18. withLatestFrom</h4><p>withLatestFrom 運作方式跟 combineLatest 有點像，只是他有主從的關係，只有在主要的 observable 送出新的值時，才會執行 callback，附隨的 observable 只是在背景下運作<br><b style="color:red">描述:</b></p>
<pre><code>1. main 送出值的时候
2. 和另外一个最新送出的值
3. 传入callback
4. main结束时, 就会complete
</code></pre><p><b>例子流程:</b></p>
<ul>
<li>main 送出了 <code>h</code>，some 上一次送出的值為 <code>0</code>，callback 得到 <code>h</code>。</li>
<li>main 送出了 <code>e</code>，some 上一次送出的值為 0，callback 得到 <code>e</code>。</li>
<li>main 送出了 <code>l</code>，some 上一次送出的值為 0，callback 得到 <code>l</code>。</li>
<li>main 送出了 <code>l</code>，some 上一次送出的值為 1，callback 得到 <code>L</code>。</li>
<li>main 送出了 <code>o</code>，some 上一次送出的值為 1，callback 得到 <code>O</code>。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> main = Rx.Observable.from(<span class="string">'hello'</span>).zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x);</div><div class="line"><span class="keyword">var</span> some = Rx.Observable.from([<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]).zip(Rx.Observable.interval(<span class="number">300</span>), (x, y) =&gt; x);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = main.withLatestFrom(some, (x, y) =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> y === <span class="number">1</span> ? x.toUpperCase() : x;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">main   : ----h----e----l----l----o|</div><div class="line">some   : --0--1--0--0--0--1|</div><div class="line"></div><div class="line">withLatestFrom(some, (x, y) =&gt;  y === 1 ? x.toUpperCase() : x);</div><div class="line"></div><div class="line">example: ----h----e----l----L----O|</div></pre></td></tr></table></figure>
<p><b style="color:red">应用:</b><br>withLatestFrom 很常用在一些 checkbox 型的功能，例如說一個編輯器，我們開啟粗體後，打出來的字就都要變粗體，粗體就像是 some observable，而我們打字就是 main observable。</p>
<h4 id="19-scan"><a href="#19-scan" class="headerlink" title="19. scan"></a>19. scan</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.from(<span class="string">'hello'</span>)</div><div class="line">             .zip(Rx.Observable.interval(<span class="number">600</span>), (x, y) =&gt; x);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.scan(<span class="function">(<span class="params">origin, next</span>) =&gt;</span> origin + next, <span class="string">''</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// h</span></div><div class="line"><span class="comment">// he</span></div><div class="line"><span class="comment">// hel</span></div><div class="line"><span class="comment">// hell</span></div><div class="line"><span class="comment">// hello</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ----h----e----l----l----o|</div><div class="line">    scan((origin, next) =&gt; origin + next, &apos;&apos;)</div><div class="line">example: ----h----(he)----(hel)----(hell)----(hello)|</div></pre></td></tr></table></figure>
<p>scan 很常用在狀態的計算處理，最簡單的就是對一個數字的加減，我們可以綁定一個 button 的 click 事件，並用 map 把 click event 轉成 1，之後送處 scan 計算值再做顯示。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> addButton = <span class="built_in">document</span>.getElementById(<span class="string">'addButton'</span>);</div><div class="line"><span class="keyword">const</span> minusButton = <span class="built_in">document</span>.getElementById(<span class="string">'minusButton'</span>);</div><div class="line"><span class="keyword">const</span> state = <span class="built_in">document</span>.getElementById(<span class="string">'state'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> addClick = Rx.Observable.fromEvent(addButton, <span class="string">'click'</span>).mapTo(<span class="number">1</span>);</div><div class="line"><span class="keyword">const</span> minusClick = Rx.Observable.fromEvent(minusButton, <span class="string">'click'</span>).mapTo(<span class="number">-1</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> numberState = Rx.Observable.empty()</div><div class="line">  .startWith(<span class="number">0</span>)</div><div class="line">  .merge(addClick, minusClick)</div><div class="line">  .scan(<span class="function">(<span class="params">origin, next</span>) =&gt;</span> origin + next, <span class="number">0</span>)</div><div class="line">  </div><div class="line">numberState</div><div class="line">  .subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; state.innerHTML = value;&#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure></p>
<h4 id="20-buffer"><a href="#20-buffer" class="headerlink" title="20. buffer"></a>20. buffer</h4><p>5个相关的operator</p>
<ul>
<li>buffer</li>
<li>bufferCount</li>
<li>bufferTime</li>
<li>bufferToggle</li>
<li>bufferWhen</li>
</ul>
<p>buffer 要傳入一個 observable(source2)，它會把原本的 observable (source)送出的元素緩存在陣列中，等到傳入的 observable(source2) 送出元素時，就會觸發把緩存的元素送出。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>);</div><div class="line"> <span class="comment">/*</span></div><div class="line"><span class="comment">    相当于</span></div><div class="line"><span class="comment">    var source2 = source.bufferTime(1000);</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">var</span> source2 = Rx.Observable.interval(<span class="number">1000</span>);</div><div class="line"><span class="keyword">var</span> example = source.buffer(source2);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// [0,1,2]</span></div><div class="line"><span class="comment">// [3,4,5]</span></div><div class="line"><span class="comment">// [6,7,8]...</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">source : --0--1--2--3--4--5--6--7..</div><div class="line">source2: ---------0---------1--------...</div><div class="line">            buffer(source2)</div><div class="line">example: ---------([0,1,2])---------([3,4,5])</div></pre></td></tr></table></figure>
<p>除了用時間來作緩存外，我們更常用數量來做緩存，範例如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>);</div><div class="line"><span class="keyword">var</span> example = source.bufferCount(<span class="number">3</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// [0,1,2]</span></div><div class="line"><span class="comment">// [3,4,5]</span></div><div class="line"><span class="comment">// [6,7,8]...</span></div></pre></td></tr></table></figure></p>
<p>可以用 buffer 來做某個事件的過濾，例如像是滑鼠連點才能真的執行，<br>這裡我們只有在 500 毫秒內連點兩下，才能成功印出 ‘success’，<br>這個功能在某些特殊的需求中非常的好用，也能用在批次處理來降低 request 傳送的次數！<br>代码如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> button = <span class="built_in">document</span>.getElementById(<span class="string">'demo'</span>);</div><div class="line"><span class="keyword">const</span> click = Rx.Observable.fromEvent(button, <span class="string">'click'</span>)</div><div class="line"><span class="keyword">const</span> example = click</div><div class="line">                .bufferTime(<span class="number">500</span>)</div><div class="line">                .filter(<span class="function"><span class="params">arr</span> =&gt;</span> arr.length &gt;= <span class="number">2</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'success'</span>); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="21-delay"><a href="#21-delay" class="headerlink" title="21. delay"></a>21. delay</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.delay(<span class="number">500</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="comment">// 2</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 4</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : --0--1--2--3--4|</div><div class="line">        delay(500)</div><div class="line">example: -------0--1--2--3--4|</div></pre></td></tr></table></figure>
<p>delay 除了可以傳入毫秒以外，也可以傳入 Date 型別的資料<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.delay(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() + <span class="number">1000</span>));</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="22-delayWhen"><a href="#22-delayWhen" class="headerlink" title="22. delayWhen"></a>22. delayWhen</h4><p><code>delayWhen</code> 可以影響每個元素，而且需要傳一個 callback 並回傳一個 observable<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">              .delayWhen(</div><div class="line">                  x =&gt; Rx.Observable.empty().delay(<span class="number">100</span> * x * x)</div><div class="line">              );</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : --0--1--2--3--4|</div><div class="line">    .delayWhen(x =&gt; Rx.Observable.empty().delay(100 * x * x));</div><div class="line">example: --0---1----2-----3-----4|</div></pre></td></tr></table></figure>
<h4 id="23-debounce"><a href="#23-debounce" class="headerlink" title="23. debounce"></a>23. debounce</h4><p>debounce 跟 debounceTime 一個是傳入 observable 另一個則是傳入毫秒，比較常用到的是 debounceTime<br><b style="color:red">描述:</b></p>
<ol>
<li>每次收到元素，等待1000毫秒</li>
<li>若1000毫秒内没有元素送出, 则把最新收到的元素送出; 若1000毫秒内收到新的元素, 重新等待1000毫秒.</li>
<li>注意若是<span style="color:red">最后一个元素</span>, 则不需要等待 1000 毫秒, 直接送出</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">300</span>).take(<span class="number">5</span>);</div><div class="line"><span class="keyword">var</span> example = source.debounceTime(<span class="number">1000</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 4</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : --0--1--2--3--4|</div><div class="line">        debounceTime(1000)</div><div class="line">example: --------------4|</div></pre></td></tr></table></figure>
<p>具体例子, 自動傳送使用者打的字到後端:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> searchInput = <span class="built_in">document</span>.getElementById(<span class="string">'searchInput'</span>);</div><div class="line"><span class="keyword">const</span> theRequestValue = <span class="built_in">document</span>.getElementById(<span class="string">'theRequestValue'</span>);</div><div class="line"></div><div class="line">Rx.Observable.fromEvent(searchInput, <span class="string">'input'</span>)</div><div class="line">  .debounceTime(<span class="number">300</span>)</div><div class="line">  .map(<span class="function"><span class="params">e</span> =&gt;</span> e.target.value)</div><div class="line">  .subscribe(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">    theRequestValue.textContent = value;</div><div class="line">    <span class="comment">// 在這裡發 request</span></div><div class="line">  &#125;)</div></pre></td></tr></table></figure></p>
<h4 id="24-throttle"><a href="#24-throttle" class="headerlink" title="24. throttle"></a>24. throttle</h4><p><b style="color:red">描述:</b></p>
<ol>
<li>第1次收到元素先送出,</li>
<li>1000毫秒以内处于关闭状态, 1000毫秒后, 若收到元素, 则送出</li>
<li>最后1个元素不一定会送出</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.interval(<span class="number">400</span>).take(<span class="number">8</span>);</div><div class="line"><span class="keyword">var</span> example = source.throttleTime(<span class="number">1000</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0</span></div><div class="line"><span class="comment">// 3</span></div><div class="line"><span class="comment">// 6</span></div><div class="line"><span class="comment">// complete</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : ---0---1---2---3---4---5---6---7|</div><div class="line">        throttleTime(1000)</div><div class="line">example: ---0-----------3-----------6----|</div></pre></td></tr></table></figure>
<p>下面要说3个处理 <code>Higher Order Observable</code>. 所謂的 Higher Order Observable 就是指一個 Observable 送出的元素還是一個 Observable，就像是二維陣列一樣，一個陣列中的每個元素都是陣列。<br>一共有3个方法:</p>
<ul>
<li>concatAll</li>
<li>mergeAll</li>
<li>switch</li>
</ul>
<h4 id="25-concatAll"><a href="#25-concatAll" class="headerlink" title="25. concatAll"></a>25. concatAll</h4><p>concatAll 會一個一個處理，一定是等前一個 observable 完成(complete)才會處理下一個 observable</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> source = click.map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.concatAll();</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">click  : ---------c-c------------------c--.. </div><div class="line">        map(e =&gt; Rx.Observable.interval(1000))</div><div class="line">source : ---------o-o------------------o--..</div><div class="line">                   \ \                  \</div><div class="line">                    \ ----0----1----2|   ----0----1----2|</div><div class="line">                     ----0----1----2|</div><div class="line">                     concatAll()</div><div class="line">example: ----------------0----1----2----0----1----2--..</div></pre></td></tr></table></figure>
<h4 id="26-switch"><a href="#26-switch" class="headerlink" title="26. switch"></a>26. switch</h4><p>当有新的 observable 来的时候, 就会把旧的退訂, 永远只处理新的 observable.<br>下面的例子, 当第2次点击的时候，<code>由于第2个observable和第1个时间小于1秒</code>，所以第1个就被退订了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> source = click.map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.switch();</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">click  : ---------c-c------------------c--.. </div><div class="line">        map(e =&gt; Rx.Observable.interval(1000))</div><div class="line">source : ---------o-o------------------o--..</div><div class="line">                   \ \                  \----0----1--...</div><div class="line">                    \ ----0----1----2----3----4--...</div><div class="line">                     ----0----1----2----3----4--...</div><div class="line">                     switch()</div><div class="line">example: -----------------0----1----2--------0----1--...</div></pre></td></tr></table></figure>
<h4 id="27-mergeAll"><a href="#27-mergeAll" class="headerlink" title="27. mergeAll"></a>27. mergeAll</h4><p>它會把二維的 observable 轉成一維的，並且能夠同時處理所有的 observable。<br><b style="color:red">若传入的参数是1, 则和concatAll是一摸一样的</b><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> source = click.map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.mergeAll();</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">click  : ---------c-c------------------c--.. </div><div class="line">        map(e =&gt; Rx.Observable.interval(1000))</div><div class="line">source : ---------o-o------------------o--..</div><div class="line">                   \ \                  \----0----1--...</div><div class="line">                    \ ----0----1----2----3----4--...</div><div class="line">                     ----0----1----2----3----4--...</div><div class="line">                     switch()</div><div class="line">example: ----------------00---11---22---33---(04)4--...</div></pre></td></tr></table></figure>
<p>另外 mergeAll 可以傳入一個數值，這個數值代表他可以同時處理的 observable 數量<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> click = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"><span class="keyword">var</span> source = click.map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.mergeAll(<span class="number">2</span>);</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">click  : ---------c-c----------o----------.. </div><div class="line">        map(e =&gt; Rx.Observable.interval(1000))</div><div class="line">source : ---------o-o----------c----------..</div><div class="line">                   \ \          \----0----1----2|     </div><div class="line">                    \ ----0----1----2|  </div><div class="line">                     ----0----1----2|</div><div class="line">                     mergeAll(2)</div><div class="line">example: ----------------00---11---22---0----1----2--..</div></pre></td></tr></table></figure>
<h4 id="28-concatMap"><a href="#28-concatMap" class="headerlink" title="28. concatMap"></a>28. concatMap</h4><p>concatMap= map+concatAll<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>))</div><div class="line">                .concatAll();</div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>相当于<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .concatMap(</div><div class="line">                    e =&gt; Rx.Observable.interval(<span class="number">100</span>).take(<span class="number">3</span>)</div><div class="line">                );                </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Marble Diagram:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : -----------c--c------------------...</div><div class="line">        concatMap(c =&gt; Rx.Observable.interval(100).take(3))</div><div class="line">example: -------------0-1-2-0-1-2---------...</div></pre></td></tr></table></figure></p>
<p>常用于發送 request 如下, <font color="red">每一個 request 會等前一個 request 完成才做處理。</font><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPostData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.concatMap(</div><div class="line">                    e =&gt; Rx.Observable.from(getPostData()));</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>concatMap 還有第二個參數是一個 selector callback，這個 callback 會傳入四個參數，分別是:</p>
<ol>
<li>外部 observable 送出的元素</li>
<li>內部 observable 送出的元素</li>
<li>外部 observable 送出元素的 index</li>
<li>內部 observable 送出元素的 index</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPostData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.concatMap(</div><div class="line">                e =&gt; Rx.Observable.from(getPostData()), </div><div class="line">                (e, res, eIndex, resIndex) =&gt; res.title);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="29-switchMap"><a href="#29-switchMap" class="headerlink" title="29. switchMap"></a>29. switchMap</h4><p>switchMap = map+switch<br>switchMap 跟 concatMap 一樣有第二個參數 selector callback 可用來回傳我們要的值<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>))</div><div class="line">                .switch();</div><div class="line">                </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>相当于:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .switchMap(</div><div class="line">                    e =&gt; Rx.Observable.interval(<span class="number">100</span>).take(<span class="number">3</span>)</div><div class="line">                );</div><div class="line">                </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Marble Diagram:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : -----------c--c-----------------...</div><div class="line">        concatMap(<span class="function"><span class="params">c</span> =&gt;</span> Rx.Observable.interval(<span class="number">100</span>).take(<span class="number">3</span>))</div><div class="line">example: ------------<span class="number">-0</span>-<span class="number">-0</span><span class="number">-1</span><span class="number">-2</span>-----------...</div></pre></td></tr></table></figure></p>
<p><code>switchMap</code> 用在HTTP request, 雖然我們發送了多個 request 但最後真正印出來的 log 只會有一個<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPostData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.switchMap(</div><div class="line">                    e =&gt; Rx.Observable.from(getPostData()));</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h4 id="30-mergeMap"><a href="#30-mergeMap" class="headerlink" title="30. mergeMap"></a>30. mergeMap</h4><p>mergeMap = map + mergeAll<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .map(<span class="function"><span class="params">e</span> =&gt;</span> Rx.Observable.interval(<span class="number">1000</span>).take(<span class="number">3</span>))</div><div class="line">                .mergeAll();</div><div class="line">                </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>相当于<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source</div><div class="line">                .mergeMap(</div><div class="line">                    e =&gt; Rx.Observable.interval(<span class="number">100</span>).take(<span class="number">3</span>)</div><div class="line">                );</div><div class="line">                </div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>Marble Diagram:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">source : -----------c-c------------------...</div><div class="line">        concatMap(c =&gt; Rx.Observable.interval(100).take(3))</div><div class="line">example: -------------0-(10)-(21)-2----------...</div></pre></td></tr></table></figure></p>
<p>mergeMap 也能傳入第2個參數和concatMap是一样的，但 mergeMap传入第3个参数限制并行数量<br>(<code>限制但是不是阻止的意思</code>)<br>下面的例子，若连续点击4下，第4个HTTP request需要等第1个结束以后才可以发送<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPostData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> example = source.mergeMap(</div><div class="line">                e =&gt; Rx.Observable.from(getPostData()), </div><div class="line">                (e, res, eIndex, resIndex) =&gt; res.title, <span class="number">3</span>);</div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><b>switchMap, mergeMap, concatMap 相同和不同的地方</b><br>共同的特性: 可以把第一個參數所回傳的 promise 物件直接轉成 observable<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPersonData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fetch(<span class="string">'https://jsonplaceholder.typicode.com/posts/1'</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> source = Rx.Observable.fromEvent(<span class="built_in">document</span>.body, <span class="string">'click'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 不需要写成 </span></div><div class="line"><span class="comment">// var example = source.concatMap(e =&gt; Rx.Observable.from(getPersonData()));</span></div><div class="line"><span class="keyword">var</span> example = source.concatMap(<span class="function"><span class="params">e</span> =&gt;</span> getPersonData());</div><div class="line">                                    <span class="comment">//直接回傳 promise 物件</span></div><div class="line"></div><div class="line">example.subscribe(&#123;</div><div class="line">    next: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(value); &#125;,</div><div class="line">    error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err); &#125;,</div><div class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">'complete'</span>); &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa"><a href="#11111-aaaaaa" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-1"><a href="#11111-aaaaaa-1" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-2"><a href="#11111-aaaaaa-2" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-3"><a href="#11111-aaaaaa-3" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-4"><a href="#11111-aaaaaa-4" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-5"><a href="#11111-aaaaaa-5" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-6"><a href="#11111-aaaaaa-6" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="11111-aaaaaa-7"><a href="#11111-aaaaaa-7" class="headerlink" title="11111. aaaaaa"></a>11111. aaaaaa</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bbbbbb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
</div><div class="tags"><a href="/blog/tags/rxjs/">rxjs</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/blog/2017/09/28/BlueLake博客主题的详细配置(转)/" class="next">BlueLake博客主题的详细配置(转)</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-of"><span class="toc-text">1. of</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-interval"><span class="toc-text">2. interval</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-map"><span class="toc-text">3. map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-mapTo"><span class="toc-text">4. mapTo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-filter"><span class="toc-text">5. filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-take"><span class="toc-text">6. take</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-first"><span class="toc-text">7. first</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-takeLast"><span class="toc-text">8. takeLast</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-last"><span class="toc-text">9. last</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-takeUntil"><span class="toc-text">10. takeUntil</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-concat"><span class="toc-text">11. concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-concatAll"><span class="toc-text">12. concatAll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-skip"><span class="toc-text">13. skip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-startWith"><span class="toc-text">14. startWith</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-merge"><span class="toc-text">15. merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-combineLatest"><span class="toc-text">16. combineLatest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-zip"><span class="toc-text">17. zip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-withLatestFrom"><span class="toc-text">18. withLatestFrom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-scan"><span class="toc-text">19. scan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20-buffer"><span class="toc-text">20. buffer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#21-delay"><span class="toc-text">21. delay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-delayWhen"><span class="toc-text">22. delayWhen</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-debounce"><span class="toc-text">23. debounce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#24-throttle"><span class="toc-text">24. throttle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25-concatAll"><span class="toc-text">25. concatAll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#26-switch"><span class="toc-text">26. switch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#27-mergeAll"><span class="toc-text">27. mergeAll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#28-concatMap"><span class="toc-text">28. concatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#29-switchMap"><span class="toc-text">29. switchMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#30-mergeMap"><span class="toc-text">30. mergeMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-1"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-2"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-3"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-4"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-5"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-6"><span class="toc-text">11111. aaaaaa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11111-aaaaaa-7"><span class="toc-text">11111. aaaaaa</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/28/Rxjs Marble Diagrams/">Rxjs Marble Diagrams</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/28/BlueLake博客主题的详细配置(转)/">BlueLake博客主题的详细配置(转)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/28/Hexo3-2-github搭建静态博客(转)/">Hexo3.2+GitHub搭建静态博客(转)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/28/github博客迁移(转)/">github博客迁移(转)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/hexo博客折腾/">hexo博客折腾</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/rxjs/">rxjs</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/blog/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/blog/tags/rxjs/" style="font-size: 15px;">rxjs</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/09/">九月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.cnblogs.com/zhengming2016" title="cnblogs-zhengming" target="_blank">cnblogs-zhengming</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/blog/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/blog/atom.xml">订阅</a> |  <a href="/blog/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/blog/." rel="nofollow">zhengming.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/blog/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/blog/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>